window.App={};window.App.Context={};window.App.Options={};
$(function(){function d(a,b,e){a=a?a:0;if(b&&(!a||a>b))a=b;return e&&(!a||a>e)?e:a}function g(){return{height:$("html, body").height(),sliderHeight:d(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0),sliderPos:d(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}}function h(a){var b=g().height-a.height;$("html, body").animate({scrollTop:a.sliderPos+
b},"fast")}function k(){$.ajax({type:"POST",url:"/api/revive",data:JSON.stringify({revivable_key:window.App.Context.revivable_key}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){a&&"OK"===a.status&&(f=!1,window.location.replace("/view/"+a.buffer_id.toString()))}).always(function(){f&&setTimeout(k,l)})}(function(){$("script").each(function(){var a=String(this.type).replace(/ /g,"");a.match(/^text\/x-omnimarkup-config(;.*)?$/)&&!a.match(/;executed=true/)&&(this.type+=
";executed=true",eval(this.innerHTML))})})();var l=window.App.Options.ajax_polling_interval,m=window.App.Options.mathjax_enabled,f=!1;(function b(){var e=$("#content"),d={buffer_id:window.App.Context.buffer_id,timestamp:window.App.Context.timestamp};setTimeout(function(){$.ajax({type:"POST",url:"/api/query",data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(c){if(c)switch(c.status){case "DISCONNECTED":f=!0;break;case "OK":var b=g();document.title=
c.filename+"\u2014"+c.dirname;$("#filename").text(c.filename);e.empty().html(c.html_part);window.App.Context.timestamp=c.timestamp;var d=$("img");c=0<d.length?function(){d.imagesLoaded(function(){h(b)})}:function(){h(b)};m?MathJax.Hub.Queue(["resetEquationNumbers",MathJax.InputJax.TeX],["Typeset",MathJax.Hub,e[0]],c):c()}}).fail(function(){}).always(function(){f?k():b()})},l)})()});
